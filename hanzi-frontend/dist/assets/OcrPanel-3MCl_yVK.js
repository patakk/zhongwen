const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D9NOukqS.js","assets/_commonjsHelpers-Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{_ as p,c as i,o,a as r,b as n,t as c,w as u,n as g,d as f,e as v}from"./index-lpTb8n5I.js";let d=null;const y={name:"OcrPanel",emits:["insert-text"],data(){return{file:null,fileName:"",previewUrl:"",isDragOver:!1,isProcessing:!1,isReady:!1,progressValue:0,statusMessage:"Loading OCR engine...",progressMessage:"",error:"",ocrText:"",copySuccess:!1,tesseract:null}},computed:{progressPercent(){if(!this.progressValue)return 0;const e=Math.round(this.progressValue*100);return Math.min(100,Math.max(0,e))}},async mounted(){await this.ensureLibLoaded()},beforeUnmount(){this.previewUrl&&URL.revokeObjectURL(this.previewUrl)},methods:{handleFileChange(e){const[s]=e.target.files||[];this.setFile(s)},handleDrop(e){var h;this.isDragOver=!1;const[s]=((h=e.dataTransfer)==null?void 0:h.files)||[];this.setFile(s)},setFile(e){e&&(this.previewUrl&&URL.revokeObjectURL(this.previewUrl),this.file=e,this.fileName=e.name,this.previewUrl=URL.createObjectURL(e),this.error="",this.ocrText="",this.copySuccess=!1,this.progressValue=0,this.progressMessage="")},async ensureLibLoaded(){if(d){this.tesseract=d,this.isReady=!0,this.statusMessage="";return}if(!this.tesseract){this.isReady=!1,this.statusMessage="Loading OCR engine...";try{const e=await v(()=>import("./index-D9NOukqS.js").then(s=>s.i),__vite__mapDeps([0,1]));if(this.tesseract=e!=null&&e.recognize?e:e.default,!this.tesseract||!this.tesseract.recognize)throw new Error("Tesseract recognize not available");d=this.tesseract,this.isReady=!0,this.statusMessage="Ready",setTimeout(()=>{this.statusMessage==="Ready"&&(this.statusMessage="")},800)}catch(e){console.error("Failed to load tesseract",e),this.error="Unable to load OCR tools. Please retry.",this.statusMessage=""}}},handleProgress(e){e&&(e.progress!==void 0&&(this.progressValue=e.progress),e.status&&(this.progressMessage=`${e.status} ${e.progress?Math.round(e.progress*100)+"%":""}`.trim()))},async runOcr(){if(!this.file){this.error="Choose an image to start.";return}if(await this.ensureLibLoaded(),!!this.tesseract){this.isProcessing=!0,this.error="",this.ocrText="",this.progressValue=0,this.progressMessage="Preparing...";try{const{data:e}=await this.tesseract.recognize(this.file,"chi_sim",{logger:s=>this.handleProgress(s)});this.ocrText=((e==null?void 0:e.text)||"").trim(),this.progressValue=1,this.progressMessage="Done"}catch(e){console.error("OCR failed",e),this.error="OCR failed. Please try a clearer image or retry."}finally{this.isProcessing=!1}}},async copyResult(){if(!(!this.ocrText||!(navigator!=null&&navigator.clipboard)))try{await navigator.clipboard.writeText(this.ocrText),this.copySuccess=!0,setTimeout(()=>{this.copySuccess=!1},1500)}catch(e){console.error("Copy failed",e)}},emitToSearch(){this.ocrText&&this.$emit("insert-text",this.ocrText.trim())}}},_={class:"ocr-panel"},m={class:"ocr-head"},b={key:0,class:"ocr-subtitle"},R={key:0,class:"status-pill"},O={class:"input-row"},x={class:"drop-copy"},C={key:0,class:"drop-title"},w={key:1,class:"drop-hint"},k={key:2,class:"file-chip"},M={key:0,class:"preview"},P=["src"],T={class:"actions side-actions"},U=["disabled"],D={key:0},L={key:1},S={key:2},V=["title"],z={class:"progress-vertical-bar"},N={key:0,class:"error"},F={key:1,class:"result"},E={class:"result-header"},I={class:"result-actions"},j=["disabled"],B={class:"result-body"},A=["value"];function G(e,s,h,J,t,l){return o(),i("div",_,[r("div",m,[r("div",null,[s[7]||(s[7]=r("div",{class:"ocr-title"},"Image OCR",-1)),t.file?n("",!0):(o(),i("div",b,"Upload a screenshot to extract hanzi or mixed text."))]),t.statusMessage?(o(),i("div",R,c(t.statusMessage),1)):n("",!0)]),r("div",O,[r("div",{class:g(["drop-area",{"is-active":t.isDragOver}]),onDragover:s[1]||(s[1]=u(a=>t.isDragOver=!0,["prevent"])),onDragleave:s[2]||(s[2]=u(a=>t.isDragOver=!1,["prevent"])),onDrop:s[3]||(s[3]=u((...a)=>l.handleDrop&&l.handleDrop(...a),["prevent"]))},[r("input",{ref:"fileInput",type:"file",accept:"image/*",class:"file-input",onChange:s[0]||(s[0]=(...a)=>l.handleFileChange&&l.handleFileChange(...a))},null,544),r("div",x,[t.file?n("",!0):(o(),i("div",C,"Drop an image or click to choose")),t.file?n("",!0):(o(),i("div",w,"PNG, JPG, screenshots. Nothing is uploaded to our servers.")),t.fileName?(o(),i("div",k,c(t.fileName),1)):n("",!0)]),t.previewUrl?(o(),i("div",M,[r("img",{src:t.previewUrl,alt:"Selected for OCR"},null,8,P)])):n("",!0)],34),r("div",T,[r("button",{type:"button",class:"btn-primary",onClick:s[4]||(s[4]=(...a)=>l.runOcr&&l.runOcr(...a)),disabled:!t.file||t.isProcessing||!t.isReady},[t.isProcessing?(o(),i("span",D,"Running OCR...")):t.isReady?(o(),i("span",S,"Run OCR")):(o(),i("span",L,"Preparing OCR..."))],8,U),t.progressValue>0||t.isProcessing?(o(),i("div",{key:0,class:"progress-vertical",title:t.progressMessage},[r("div",z,[r("div",{class:"progress-vertical-fill",style:f({height:l.progressPercent+"%"})},null,4)])],8,V)):n("",!0)])]),t.error?(o(),i("div",N,c(t.error),1)):n("",!0),t.ocrText?(o(),i("div",F,[r("div",E,[s[8]||(s[8]=r("div",null,[r("div",{class:"result-title"},"OCR result"),r("div",{class:"result-subtitle"},"Review and refine before searching.")],-1)),r("div",I,[r("button",{type:"button",class:"chip",onClick:s[5]||(s[5]=(...a)=>l.copyResult&&l.copyResult(...a)),disabled:t.copySuccess},c(t.copySuccess?"Copied":"Copy"),9,j),r("button",{type:"button",class:"chip primary",onClick:s[6]||(s[6]=(...a)=>l.emitToSearch&&l.emitToSearch(...a))}," Add to search ")])]),r("div",B,[r("textarea",{readonly:"",value:t.ocrText,style:{"box-sizing":"border-box"}},null,8,A)])])):n("",!0)])}const H=p(y,[["render",G],["__scopeId","data-v-d5fe3bb1"]]);export{H as default};
